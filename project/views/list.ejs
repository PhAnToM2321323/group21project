<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
  <title>Bookings List</title>
  <style>
    :root{
      --primary: #1A73E8;
      --primary-hover: #1558b8;
      --surface: #ffffff;
      --bg: #f6f8fb;
      --muted: #6b6f76;
      --danger: #d93025;
      --text: #202124;
      --card-shadow: 0 4px 20px rgba(32,33,36,0.06);
      --card-shadow-soft: 0 8px 30px rgba(32,33,36,0.06);
      --radius: 12px;
      --t-fast: 160ms;
      --t-medium: 260ms;
      --t-slow: 460ms;
      --ripple: rgba(255,255,255,0.18);
    }
    :root[data-theme="dark"]{
      --primary: #8ab4f8;
      --primary-hover: #7aa4e0;
      --surface: #1c1f23;
      --bg: #0f1113;
      --muted: #9aa0a6;
      --danger: #f28b82;
      --text: #e8eaed;
      --card-shadow: 0 6px 28px rgba(0,0,0,0.6);
      --card-shadow-soft: 0 10px 40px rgba(0,0,0,0.6);
      --ripple: rgba(0,0,0,0.12);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      margin:0;
      padding:28px;
      -webkit-font-smoothing:antialiased;
      transition: background var(--t-medium) ease, color var(--t-medium) ease;
    }

    /* Top bar */
    .top-bar{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:20px; }
    .welcome{ display:flex; gap:12px; align-items:center; }
    .username-badge{
      display:inline-flex; align-items:center; gap:12px; padding:10px 14px; border-radius:999px;
      background: linear-gradient(180deg, rgba(26,115,232,0.06), rgba(26,115,232,0.03));
      color:var(--primary); font-weight:600; font-size:15px;
      box-shadow: 0 2px 0 rgba(26,115,232,0.04);
      transform-origin:center left;
      transition: transform var(--t-medium) cubic-bezier(.2,1.1,.25,1), box-shadow var(--t-fast), opacity var(--t-fast);
      opacity:0.98;
    }
    .username-badge:hover{ transform: translateY(-3px) scale(1.02); }

    .controls{ display:flex; gap:12px; align-items:center }

    /* Theme controls */
    .theme-wrapper{ position:relative }
    .theme-btn{
      display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px;
      border:1px solid rgba(0,0,0,0.06); background:transparent; color:var(--muted); cursor:pointer; font-weight:600;
      transition: background var(--t-fast), box-shadow var(--t-fast), transform var(--t-fast), border-color var(--t-fast), color var(--t-fast);
    }
    .theme-btn svg{ width:16px; height:16px; display:block }
    :root[data-theme="dark"] .theme-btn{ border-color: rgba(255,255,255,0.06); }

    .quick-toggle{ display:inline-flex; align-items:center; gap:8px; padding:6px; border-radius:999px; background:transparent; cursor:pointer; border:1px solid rgba(0,0,0,0.04); }
    .toggle-knob{ width:36px; height:20px; border-radius:999px; background:linear-gradient(90deg,#fff,#f3f9ff); display:flex; align-items:center; padding:2px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.6); }
    .knob{ width:16px; height:16px; border-radius:50%; background:var(--primary); transform:translateX(0); transition: transform 300ms cubic-bezier(.2,1.1,.25,1); }
    :root[data-theme="dark"] .knob{ transform: translateX(16px); background:var(--primary); }

    .theme-menu{
      position:absolute; right:0; margin-top:10px; min-width:190px; border-radius:12px; background:var(--surface);
      box-shadow: var(--card-shadow-soft); transform-origin: top right; transform: translateY(-10px) scale(0.96); opacity:0; pointer-events:none; z-index:1000; padding:8px; transition: transform var(--t-fast) ease, opacity var(--t-fast) ease;
    }
    .theme-menu.open{ transform: translateY(0) scale(1); opacity:1; pointer-events:auto; }
    .theme-item{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer; font-size:14px; color:var(--text); transition: background var(--t-fast), transform var(--t-fast); }
    .theme-item:hover{ transform: translateY(-3px); background: rgba(26,115,232,0.04); }
    .theme-item .dot{ width:12px; height:12px; border-radius:50%; box-shadow: 0 1px 0 rgba(0,0,0,0.06); }
    .dot.auto{ background: linear-gradient(180deg,#e0e0e0,#bdbdbd); }
    .dot.light{ background: linear-gradient(180deg,#ffffff,#f1f1f1); border:1px solid #e6e6e6; }
    .dot.dark{ background: linear-gradient(180deg,#2b2b2b,#121212); }

    .logout-btn{
      background:transparent; border:none; padding:8px 10px; border-radius:8px; font-weight:600; cursor:pointer; color:var(--primary);
      transition: color var(--t-fast), background var(--t-fast), transform var(--t-fast);
      text-decoration:none;
    }
    .logout-btn:hover, .logout-btn:focus{ color:var(--danger); outline:none; background: rgba(0,0,0,0.02); transform: translateY(-2px); }

    /* New booking button */
    .fab{
      display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:20px;
      background:var(--primary); color:var(--surface); text-decoration:none; font-weight:700;
      box-shadow: 0 10px 30px rgba(26,115,232,0.14); transition: transform var(--t-medium), box-shadow var(--t-medium);
    }
    .fab:hover{ transform: translateY(-6px) scale(1.02); box-shadow: 0 20px 50px rgba(26,115,232,0.16); }

    /* Search card */
    .search-card{ background:var(--surface); border-radius:var(--radius); padding:16px; box-shadow: var(--card-shadow); display:flex; gap:12px; align-items:center; margin:18px 0; }
    .search-card:focus-within{ box-shadow: var(--card-shadow-soft); transform: translateY(-4px); }
    .search-card label{ font-size:14px; color:var(--muted); display:flex; gap:8px; align-items:center; }
    .search-card input{ border:1px solid rgba(0,0,0,0.06); padding:10px 12px; border-radius:10px; outline:none; min-width:140px; transition: box-shadow var(--t-fast), border-color var(--t-fast), transform var(--t-fast); background:transparent; }
    .search-card input:focus{ border-color:var(--primary); box-shadow:0 12px 36px rgba(26,115,232,0.06); transform: translateY(-2px); }
    .btn{ --btn-radius: 12px; position:relative; overflow:hidden; border:none; padding:10px 16px; border-radius:12px; font-weight:700; cursor:pointer; transition: box-shadow var(--t-fast), transform var(--t-fast), opacity var(--t-fast); background:var(--primary); color:var(--surface); }
    .btn.ghost{ background:transparent; color:var(--muted); border:1px solid rgba(0,0,0,0.06); }
    .btn.warn{ background:var(--danger); }

    /* Table */
    .table-card{ background:var(--surface); border-radius:12px; box-shadow: var(--card-shadow); overflow:hidden; transition: box-shadow var(--t-medium), transform var(--t-medium); }
    .table-card:hover{ box-shadow: var(--card-shadow-soft); transform: translateY(-4px); }
    table{ width:100%; border-collapse:collapse; min-width:720px; }
    thead th{ text-align:left; font-weight:700; padding:14px 18px; font-size:14px; color:var(--surface); background: linear-gradient(180deg, var(--primary), var(--primary-hover)); border-bottom:4px solid rgba(0,0,0,0.04); }
    tbody td{ padding:14px 18px; color:var(--text); font-size:14px; border-bottom:1px solid rgba(0,0,0,0.04); transition: background var(--t-fast), transform var(--t-medium); }
    tbody tr{ transition: transform 420ms cubic-bezier(.2,1.05,.25,1), box-shadow 420ms; transform-origin:left center; }
    tbody tr:hover{ transform: translateY(-6px) scale(1.01); box-shadow: 0 18px 40px rgba(0,0,0,0.06); }
    tbody tr:hover td{ background: rgba(26,115,232,0.03); }

    /* Action pills */
    .action-pill{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; font-size:13px; color:var(--surface); text-decoration:none; margin-right:6px; transition: transform 220ms cubic-bezier(.2,1.05,.25,1), box-shadow 220ms; }
    .action-pill:hover{ transform: translateY(-4px) scale(1.03); box-shadow: 0 12px 30px rgba(0,0,0,0.08); }
    .action-pill.detail{ background:#0f9d58; } 
    .action-pill.edit{ background:#1a73e8; } 
    .action-pill.delete{ background:var(--danger); }

    .muted { color:var(--muted); font-size:13px; }

    @media (max-width:820px){
      .search-card{ flex-direction:column; align-items:flex-start; gap:10px; }
      table{ min-width:unset; font-size:13px; }
    }

    @keyframes floatIn{ from { opacity:0; transform: translateY(12px) scale(0.996);} 60%{ transform: translateY(-6px) scale(1.003);} to{ opacity:1; transform: translateY(0) scale(1);} }
    .table-card, .search-card, .fab, .username-badge{ animation: floatIn var(--t-medium) cubic-bezier(.2,1.05,.25,1) both; }
    @keyframes rowEnter{ 0%{ opacity:0; transform: translateY(18px) scale(0.996);} 60%{ opacity:1; transform: translateY(-6px) scale(1.004);} 100%{ transform: translateY(0) scale(1);} }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="welcome">
      <div class="username-badge">Welcome, <%= user %></div>
    </div>
    <div class="controls">
      <!-- Quick toggle + menu -->
      <div class="theme-wrapper">
        <div style="display:flex;align-items:center;gap:8px">
          <button id="quick-toggle" class="quick-toggle" title="Toggle light/dark">
            <div class="toggle-knob" aria-hidden="true"><div class="knob"></div></div>
          </button>
          <button id="theme-btn" class="theme-btn" aria-haspopup="true" aria-expanded="false" aria-controls="theme-menu" title="Open theme menu">
            <svg id="theme-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3a9 9 0 100 18 9 9 0 000-18z" fill="currentColor"/></svg>
            <span id="theme-label">Theme</span>
          </button>
        </div>
        <div id="theme-menu" class="theme-menu" role="menu" aria-labelledby="theme-btn" tabindex="-1">
          <div class="theme-item" role="menuitem" data-value="auto" tabindex="0" aria-selected="false">
            <span class="dot auto" aria-hidden="true"></span><div style="font-weight:600">System (Auto)</div>
          </div>
          <div class="theme-item" role="menuitem" data-value="light" tabindex="0" aria-selected="false">
            <span class="dot light" aria-hidden="true"></span><div style="font-weight:600">Light</div>
          </div>
          <div class="theme-item" role="menuitem" data-value="dark" tabindex="0" aria-selected="false">
            <span class="dot dark" aria-hidden="true"></span><div style="font-weight:600">Dark</div>
          </div>
        </div>
      </div>
      <a href="/logout" class="logout-btn" aria-label="Logout">Logout</a>
    </div>
  </div>

  <a class="fab" href="/create" role="button" aria-label="Create booking">âž• New Booking</a>

  <div class="search-card" role="region" aria-label="search-booking">
    <form action="/find" method="GET" style="display:flex;gap:12px;align-items:center;width:100%;">
      <label>Booking Name<input name="bookingid" inputmode="text" autocomplete="off" placeholder="e.g. Mr/Miss Chan" /></label>
      <label>Mobile<input name="mobile" inputmode="tel" autocomplete="tel" placeholder="e.g. +852 1234 5678" /></label>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button type="submit" class="btn" id="search-btn">Search</button>
        <button type="button" class="btn ghost" id="show-all" onclick="location.href='/find'">Show All</button>
      </div>
    </form>
  </div>

  <div style="display:flex;align-items:center;justify-content:space-between;margin:8px 0 12px">
    <h3 style="margin:0;font-weight:700">Bookings <span class="muted">(Total <%= nBookings %>)</span></h3>
  </div>

  <div class="table-card" role="table" aria-label="Bookings table">
    <table>
      <thead>
        <tr><th>Booking Name</th><th>Date</th><th>Mobile</th><th>Guests</th><th>Actions</th></tr>
      </thead>
      <tbody>
        <% bookings.forEach(b => { %>
          <tr style="animation: rowEnter 420ms cubic-bezier(.2,1.05,.25,1) both">
            <td><a href="/details?_id=<%= b._id %>"><%= b.bookingid %></a></td>
            <td><%= b.bookingdate ? new Date(b.bookingdate).toLocaleDateString() : 'Not set' %></td>
            <td><%= b.mobile %></td>
            <td><%= b.guests %></td>
            <td>
              <a href="/details?_id=<%= b._id %>" class="action-pill detail" title="Details">Details</a>
              <a href="/edit?_id=<%= b._id %>" class="action-pill edit" title="Edit">Edit</a>
              <a href="/delete?_id=<%= b._id %>" class="action-pill delete" title="Delete" onclick="return confirm('Delete this booking?')">Delete</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <script>
  // Theme persistence + menu/quick-toggle (same behavior as your example)
  (function(){
    const THEME_KEY = 'bookings_theme_pref_v4';
    const root = document.documentElement;
    const btn = document.getElementById('theme-btn');
    const menu = document.getElementById('theme-menu');
    const icon = document.getElementById('theme-icon');
    const label = document.getElementById('theme-label');
    const quick = document.getElementById('quick-toggle');
    const knob = document.querySelector('.knob');
    const items = menu ? Array.from(menu.querySelectorAll('.theme-item')) : [];

    function setIconFor(val){
      if(!icon) return;
      if(val === 'dark'){
        icon.innerHTML = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor"/>';
        label.textContent = 'Dark';
      } else if(val === 'light'){
        icon.innerHTML = '<path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10 9h2v-3h-2v3zm7.24-1.84l1.79-1.79-1.79-1.8-1.79 1.8 1.79 1.79zM20 13h3v-2h-3v2zM6.76 19.16l-1.8 1.79L3.17 19.16l1.79-1.79 1.8 1.79zM12 6a6 6 0 100 12 6 6 0 000-12z" fill="currentColor"/>';
        label.textContent = 'Light';
      } else {
        icon.innerHTML = '<path d="M12 3a9 9 0 100 18 9 9 0 000-18z" fill="currentColor"/>';
        label.textContent = 'Auto';
      }
      if(knob){ knob.style.transform = (val === 'dark') ? 'translateX(16px)' : 'translateX(0)'; }
    }

    function applyTheme(val){
      if(val === 'dark') root.dataset.theme = 'dark';
      else if(val === 'light') delete root.dataset.theme;
      else {
        delete root.dataset.theme;
        try{ if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) root.dataset.theme = 'dark'; }catch(e){}
      }
      items.forEach(it=> it.setAttribute('aria-selected', it.dataset.value === val ? 'true' : 'false'));
      setIconFor(val);
    }

    let pref = localStorage.getItem(THEME_KEY) || 'auto';
    applyTheme(pref);

    // Menu open/close + keyboard navigation
    let open=false;
    function onKeyDown(e){ 
      const active = document.activeElement; 
      const idx = items.indexOf(active); 
      if(e.key==='Escape'){ closeMenu(true); return; } 
      if(e.key==='ArrowDown'){ e.preventDefault(); const next = items[(idx+1)%items.length]; if(next) next.focus(); } 
      else if(e.key==='ArrowUp'){ e.preventDefault(); const prev = items[(idx-1+items.length)%items.length]; if(prev) prev.focus(); } 
      else if(e.key==='Tab'){ closeMenu(false); }
    }
    function openMenu(){ if(open) return; menu.classList.add('open'); btn.setAttribute('aria-expanded','true'); open=true; const sel = items.find(i=>i.getAttribute('aria-selected')==='true')||items[0]; if(sel) sel.focus(); document.addEventListener('keydown', onKeyDown); }
    function closeMenu(returnFocus){ if(!open) return; menu.classList.remove('open'); btn.setAttribute('aria-expanded','false'); open=false; document.removeEventListener('keydown', onKeyDown); if(returnFocus) btn.focus(); }

    btn && btn.addEventListener('click', (e)=>{ e.stopPropagation(); if(open) closeMenu(true); else openMenu(); });
    document.addEventListener('pointerdown', (e)=>{ if(!open) return; if(e.target.closest('.theme-wrapper')) return; closeMenu(false); }, {passive:true});

    items.forEach(it=>{
      it.addEventListener('click', ()=>{
        const v = it.dataset.value;
        pref = v; localStorage.setItem(THEME_KEY, v); applyTheme(v); closeMenu(true);
      });
      it.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); it.click(); } });
    });

    // Quick toggle: dark <-> light (ignoring auto)
    quick && quick.addEventListener('click', ()=>{
      const current = localStorage.getItem(THEME_KEY) || 'auto';
      const next = current === 'dark' ? 'light' : 'dark';
      localStorage.setItem(THEME_KEY, next); pref = next; applyTheme(next);
    });

    // React to system theme change when pref is auto
    if(window.matchMedia){
      const mq = window.matchMedia('(prefers-color-scheme: dark)');
      try{ mq.addEventListener('change', ()=>{ if((localStorage.getItem(THEME_KEY) || 'auto') === 'auto') applyTheme('auto'); }); }catch(e){}
    }
  })();

  // Ripple effect on clickable elements
  (function(){
    function getVar(name){ try{ return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || null; }catch(e){ return null; } }
    function addRipple(el, ev){
      if(!el || !ev || !el.getBoundingClientRect) return;
      const rect = el.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height) * 1.8;
      const ripple = document.createElement('span');
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = (ev.clientX - rect.left - size/2) + 'px';
      ripple.style.top = (ev.clientY - rect.top - size/2) + 'px';
      Object.assign(ripple.style, {
        position:'absolute', borderRadius:'50%', transform:'scale(0)', opacity:'0.6', pointerEvents:'none', zIndex:'1000',
        background: getVar('--ripple') || 'rgba(255,255,255,0.12)',
        transition: 'transform 560ms cubic-bezier(.2,1.05,.25,1), opacity 560ms ease'
      });
      ripple.className='ripple';
      const cs = getComputedStyle(el);
      el.style.position = cs.position === 'static' ? 'relative' : cs.position;
      el.appendChild(ripple);
      requestAnimationFrame(()=>{ ripple.style.transform='scale(1)'; ripple.style.opacity='0'; });
      setTimeout(()=>{ try{ ripple.remove(); }catch(e){} }, 620);
    }
    document.addEventListener('pointerdown', function(e){
      try{
        const btn = e.target.closest && e.target.closest('.btn, .fab, .action-pill, .theme-btn, .theme-item, .logout-btn, .quick-toggle');
        if(!btn) return;
        addRipple(btn, e);
      }catch(err){}
    }, {passive:true});
  })();
  </script>
</body>
</html>
